<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>橙子天天开心！</title>
    <link rel="icon" href="public/love/photos/favicon.png" type="image/png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:ital,wght@0,400;0,700;1,400&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
          width: 100%;
          height: 100%;
          overflow: hidden;
          background: #0a0208;
          font-family: 'Lora', serif;
        }

        canvas#bgCanvas {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          z-index: 0;
        }

        canvas#petalCanvas {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          z-index: 3;
          pointer-events: none;
        }

        .container {
          position: relative;
          z-index: 5;
          width: 100%;
          height: 100vh;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: min(1.5vh, 12px);
          padding: 2vh 16px;
        }

        .title {
          font-family: 'Great Vibes', cursive;
          font-size: clamp(28px, 6vw, 64px);
          color: transparent;
          background: linear-gradient(135deg, #ff4d6d, #ffb3c1, #ffd700, #ffb3c1, #ff4d6d);
          background-size: 300% 300%;
          -webkit-background-clip: text;
          background-clip: text;
          animation: shimmer 4s ease-in-out infinite, fadeInDown 2s ease-out forwards;
          opacity: 0;
          text-shadow: 0 0 40px rgba(255, 77, 109, 0.3);
          text-align: center;
          line-height: 1.2;
          flex-shrink: 0;
        }

        .subtitle {
          font-family: 'Lora', serif;
          font-style: italic;
          font-size: clamp(12px, 2vw, 18px);
          color: #ffb3c1;
          opacity: 0;
          animation: fadeInUp 2s ease-out 1.5s forwards;
          text-align: center;
          letter-spacing: 2px;
          max-width: 500px;
          padding: 0 16px;
          line-height: 1.6;
          flex-shrink: 0;
        }

        .heart-line {
          display: flex;
          gap: 10px;
          opacity: 0;
          animation: fadeInUp 1.5s ease-out 2.5s forwards;
          flex-shrink: 0;
        }

        .heart-line span {
          color: #ff4d6d;
          font-size: 16px;
          animation: heartbeat 1.2s ease-in-out infinite;
        }

        .heart-line span:nth-child(2) { animation-delay: 0.15s; }
        .heart-line span:nth-child(3) { animation-delay: 0.3s; }
        .heart-line span:nth-child(4) { animation-delay: 0.45s; }
        .heart-line span:nth-child(5) { animation-delay: 0.6s; }

        .rose-wrapper {
          position: relative;
          animation: floatY 4s ease-in-out infinite;
          filter: drop-shadow(0 0 30px rgba(255, 50, 80, 0.4)) drop-shadow(0 0 60px rgba(255, 50, 80, 0.2));
          flex-shrink: 1;
          min-height: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .glow-ring {
          position: absolute;
          top: 50%; left: 50%;
          transform: translate(-50%, -50%);
          width: 280px; height: 280px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(255,77,109,0.15) 0%, transparent 70%);
          animation: pulse-glow 3s ease-in-out infinite;
          pointer-events: none;
        }

        #roseCanvas {
          display: block;
          max-height: 38vh;
          width: auto;
          height: auto;
        }

        .message-box {
          opacity: 0;
          animation: fadeInUp 2s ease-out 3s forwards;
          background: rgba(255, 77, 109, 0.08);
          border: 1px solid rgba(255, 77, 109, 0.2);
          border-radius: 12px;
          padding: min(2vh, 16px) min(4vw, 28px);
          backdrop-filter: blur(10px);
          max-width: 460px;
          text-align: center;
          flex-shrink: 0;
        }

        .message-box p {
          color: #e8a0b4;
          font-size: clamp(12px, 2vw, 15px);
          line-height: 1.9;
          font-family: 'Lora', serif;
        }

        .message-box .sign {
          margin-top: 8px;
          font-family: 'Great Vibes', cursive;
          font-size: clamp(18px, 3.5vw, 26px);
          color: #ff6b8a;
        }

        .fireflies {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          z-index: 1;
          pointer-events: none;
          overflow: hidden;
        }

        .firefly {
          position: absolute;
          width: 4px; height: 4px;
          border-radius: 50%;
          background: #ffd700;
          box-shadow: 0 0 6px 2px rgba(255, 215, 0, 0.6), 0 0 12px 4px rgba(255, 215, 0, 0.3);
          animation: fireflyMove linear infinite, fireflyGlow 2s ease-in-out infinite alternate;
        }

        @keyframes shimmer {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
        }

        @keyframes fadeInDown {
          from { opacity: 0; transform: translateY(-30px); }
          to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }

        @keyframes heartbeat {
          0%, 100% { transform: scale(1); }
          15% { transform: scale(1.3); }
          30% { transform: scale(1); }
          45% { transform: scale(1.2); }
          60% { transform: scale(1); }
        }

        @keyframes floatY {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-8px); }
        }

        @keyframes pulse-glow {
          0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
          50% { opacity: 1; transform: translate(-50%, -50%) scale(1.15); }
        }

        @keyframes fireflyMove {
          0% { transform: translateY(0) translateX(0); }
          25% { transform: translateY(-30vh) translateX(15vw); }
          50% { transform: translateY(-55vh) translateX(-10vw); }
          75% { transform: translateY(-80vh) translateX(5vw); }
          100% { transform: translateY(-110vh) translateX(-5vw); }
        }

        @keyframes fireflyGlow {
          from { opacity: 0.2; }
          to { opacity: 1; }
        }

        .vignette {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          z-index: 4;
          pointer-events: none;
          background: radial-gradient(ellipse at center, transparent 50%, rgba(10,2,8,0.85) 100%);
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="fireflies" id="fireflies"></div>

<div class="container">
    <h1 class="title">Happy Valentine's Day</h1>

    <div class="heart-line">
        <span>&#10084;</span>
        <span>&#10084;</span>
        <span>&#10084;</span>
        <span>&#10084;</span>
        <span>&#10084;</span>
    </div>

    <div class="rose-wrapper">
        <div class="glow-ring"></div>
        <canvas id="roseCanvas" width="360" height="360"></canvas>
    </div>

    <p class="subtitle">Every petal of this rose carries my love across the distance between us.</p>

    <div class="message-box">
        <p>
            虽然我不在你身边，<br>
            但我的心始终与你同在。<br>
            这朵玫瑰为你而开，<br>
            愿它替我守护你每一个瞬间。<br>
            橙子天天开心！
        </p>
        <div class="sign">Forever Yours</div>
    </div>
</div>

<canvas id="petalCanvas"></canvas>
<div class="vignette"></div>

<script>
    // ============================================================
    //  1. STARRY BACKGROUND CANVAS
    // ============================================================
    (function() {
      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d');
      let W, H;
      const stars = [];
      const shootingStars = [];
      const STAR_COUNT = 220;

      function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resize);
      resize();

      for (let i = 0; i < STAR_COUNT; i++) {
        stars.push({
          x: Math.random() * W,
          y: Math.random() * H,
          r: Math.random() * 1.6 + 0.3,
          alpha: Math.random(),
          dAlpha: (Math.random() * 0.02 + 0.005) * (Math.random() < 0.5 ? 1 : -1),
          color: ['#ffffff','#ffe4e8','#ffd6e0','#ffecd2','#c9b1ff'][Math.floor(Math.random()*5)]
        });
      }

      function spawnShootingStar() {
        shootingStars.push({
          x: Math.random() * W,
          y: Math.random() * H * 0.4,
          len: Math.random() * 80 + 60,
          speed: Math.random() * 6 + 4,
          angle: Math.PI / 4 + Math.random() * 0.3,
          alpha: 1,
          life: 1
        });
      }
      setInterval(spawnShootingStar, 4000 + Math.random() * 3000);

      function drawBg() {
        const grad = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, Math.max(W, H) * 0.7);
        grad.addColorStop(0, '#1a0a14');
        grad.addColorStop(0.4, '#0f0510');
        grad.addColorStop(0.7, '#0a0208');
        grad.addColorStop(1, '#050105');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, W, H);

        const t = Date.now() * 0.0001;
        for (let i = 0; i < 3; i++) {
          const cx = W * (0.3 + 0.4 * Math.sin(t + i * 2));
          const cy = H * (0.3 + 0.3 * Math.cos(t * 0.7 + i));
          const nebula = ctx.createRadialGradient(cx, cy, 0, cx, cy, 300);
          nebula.addColorStop(0, `rgba(${120 + i*40}, ${20 + i*10}, ${60 + i*20}, 0.04)`);
          nebula.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.fillStyle = nebula;
          ctx.fillRect(0, 0, W, H);
        }
      }

      function drawStars() {
        for (const s of stars) {
          s.alpha += s.dAlpha;
          if (s.alpha > 1 || s.alpha < 0.1) s.dAlpha *= -1;
          s.alpha = Math.max(0.1, Math.min(1, s.alpha));
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          ctx.fillStyle = s.color;
          ctx.globalAlpha = s.alpha;
          ctx.fill();
          if (s.r > 1) {
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.r * 3, 0, Math.PI * 2);
            ctx.fillStyle = s.color;
            ctx.globalAlpha = s.alpha * 0.1;
            ctx.fill();
          }
        }
        ctx.globalAlpha = 1;
      }

      function drawShootingStars() {
        for (let i = shootingStars.length - 1; i >= 0; i--) {
          const ss = shootingStars[i];
          ss.x += Math.cos(ss.angle) * ss.speed;
          ss.y += Math.sin(ss.angle) * ss.speed;
          ss.life -= 0.012;
          ss.alpha = ss.life;
          if (ss.life <= 0) { shootingStars.splice(i, 1); continue; }
          const tailX = ss.x - Math.cos(ss.angle) * ss.len;
          const tailY = ss.y - Math.sin(ss.angle) * ss.len;
          const grad = ctx.createLinearGradient(tailX, tailY, ss.x, ss.y);
          grad.addColorStop(0, 'rgba(255,255,255,0)');
          grad.addColorStop(1, `rgba(255,220,230,${ss.alpha})`);
          ctx.beginPath();
          ctx.moveTo(tailX, tailY);
          ctx.lineTo(ss.x, ss.y);
          ctx.strokeStyle = grad;
          ctx.lineWidth = 1.5;
          ctx.stroke();
          ctx.beginPath();
          ctx.arc(ss.x, ss.y, 2, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(255,240,245,${ss.alpha})`;
          ctx.fill();
        }
      }

      function animateBg() {
        drawBg();
        drawStars();
        drawShootingStars();
        requestAnimationFrame(animateBg);
      }
      animateBg();
    })();


    // ============================================================
    //  2. PURE ROSE HEAD - 10s LOOP ANIMATION
    //     Bloom(0-3s) -> Full(3-5s) -> Wither(5-8s) -> Reset(8-10s)
    // ============================================================
    (function() {
      const canvas = document.getElementById('roseCanvas');
      const ctx = canvas.getContext('2d');
      const W = canvas.width;
      const H = canvas.height;
      const cx = W / 2;
      const cy = H / 2;

      const CYCLE = 10000; // 10 seconds in ms
      let startTime = Date.now();

      // Color palettes for different states
      function lerpColor(a, b, t) {
        const ar = parseInt(a.slice(1,3),16), ag = parseInt(a.slice(3,5),16), ab = parseInt(a.slice(5,7),16);
        const br = parseInt(b.slice(1,3),16), bg = parseInt(b.slice(3,5),16), bb = parseInt(b.slice(5,7),16);
        const r = Math.round(ar + (br - ar) * t);
        const g = Math.round(ag + (bg - ag) * t);
        const bv = Math.round(ab + (bb - ab) * t);
        return `rgb(${r},${g},${bv})`;
      }

      function darkenColor(hex, factor) {
        const r = parseInt(hex.slice(1,3), 16);
        const g = parseInt(hex.slice(3,5), 16);
        const b = parseInt(hex.slice(5,7), 16);
        return `rgb(${Math.floor(r*factor)},${Math.floor(g*factor)},${Math.floor(b*factor)})`;
      }

      // Petal colors per requirement
      const innerColors = { inner: '#FF1F5F', outer: '#FF3D78' };
      const midColors   = { inner: '#FF4D88', outer: '#FF70A0' };
      const outerColors = { inner: '#FF80AD', outer: '#FFB3C6' };

      // Withered versions (faded to #FFCCD8)
      const witherInner = { inner: '#FFAABB', outer: '#FFCCD8' };
      const witherMid   = { inner: '#FFBBCC', outer: '#FFCCD8' };
      const witherOuter = { inner: '#FFCCD8', outer: '#FFDDE6' };

      function blendPalette(fresh, wither, t) {
        return {
          inner: lerpColor(fresh.inner, wither.inner, t),
          outer: lerpColor(fresh.outer, wither.outer, t)
        };
      }

      function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }
      function easeInCubic(t) { return t * t * t; }
      function easeInOutCubic(t) { return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; }

      function drawPetal(px, py, angle, radiusX, radiusY, colorInner, colorOuter, alpha, droopAngle) {
        ctx.save();
        ctx.translate(px, py);
        ctx.rotate(angle);

        // Add droop for wither effect
        if (droopAngle) {
          ctx.rotate(droopAngle);
        }

        ctx.beginPath();
        ctx.moveTo(0, 0);
        // Organic petal with bezier curves - pointed top, wavy edges
        ctx.bezierCurveTo(
          radiusX * 0.45, -radiusY * 0.25,
          radiusX * 0.85, -radiusY * 0.8,
          radiusX * 0.05, -radiusY
        );
        ctx.bezierCurveTo(
          -radiusX * 0.75, -radiusY * 0.8,
          -radiusX * 0.45, -radiusY * 0.25,
          0, 0
        );

        const grad = ctx.createRadialGradient(0, -radiusY * 0.3, 0, 0, -radiusY * 0.4, radiusY);
        grad.addColorStop(0, colorInner);
        grad.addColorStop(0.6, colorOuter);
        grad.addColorStop(1, darkenColor(colorOuter.startsWith('#') ? colorOuter : '#FF80AD', 0.7));
        ctx.fillStyle = grad;
        ctx.globalAlpha = alpha;
        ctx.fill();

        // Subtle vein
        ctx.beginPath();
        ctx.moveTo(0, -2);
        ctx.quadraticCurveTo(radiusX * 0.08, -radiusY * 0.5, 0, -radiusY * 0.88);
        ctx.strokeStyle = 'rgba(0,0,0,0.06)';
        ctx.lineWidth = 0.5;
        ctx.stroke();

        // Soft edge highlight
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(
          radiusX * 0.45, -radiusY * 0.25,
          radiusX * 0.85, -radiusY * 0.8,
          radiusX * 0.05, -radiusY
        );
        ctx.strokeStyle = `rgba(255,255,255,0.08)`;
        ctx.lineWidth = 0.6;
        ctx.stroke();

        ctx.globalAlpha = 1;
        ctx.restore();
      }

      function drawRoseCenter(progress, witherFactor) {
        const spiralTurns = 3;
        const maxR = 14 * progress;

        ctx.save();
        ctx.translate(cx, cy);

        for (let i = 0; i < spiralTurns * 40; i++) {
          const angle = (i / 40) * Math.PI * 2;
          const r = (i / (spiralTurns * 40)) * maxR;
          const x = Math.cos(angle) * r;
          const y = Math.sin(angle) * r * 0.6;
          ctx.beginPath();
          ctx.arc(x, y, 1.5 - (i / (spiralTurns * 40)), 0, Math.PI * 2);
          const alpha = (1 - (i / (spiralTurns * 40)) * 0.5) * progress;
          const rv = Math.round(180 + 75 * witherFactor);
          const gv = Math.round(20 + 140 * witherFactor);
          const bv = Math.round(40 + 120 * witherFactor);
          ctx.fillStyle = `rgba(${rv}, ${gv}, ${bv}, ${alpha})`;
          ctx.fill();
        }

        const budR = 9 * progress;
        const budGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, budR);
        const c1 = lerpColor('#FF1F5F', '#FFAABB', witherFactor);
        const c2 = lerpColor('#c62828', '#FFBBCC', witherFactor);
        const c3 = lerpColor('#7f0000', '#FFCCD8', witherFactor);
        budGrad.addColorStop(0, c1);
        budGrad.addColorStop(0.5, c2);
        budGrad.addColorStop(1, c3);
        ctx.beginPath();
        ctx.arc(0, 0, budR, 0, Math.PI * 2);
        ctx.fillStyle = budGrad;
        ctx.fill();

        ctx.restore();
      }

      function drawDewDrop(x, y, r) {
        if (r < 0.5) return;
        ctx.save();
        const dewGrad = ctx.createRadialGradient(x - r * 0.3, y - r * 0.3, 0, x, y, r);
        dewGrad.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
        dewGrad.addColorStop(0.3, 'rgba(200, 230, 255, 0.5)');
        dewGrad.addColorStop(1, 'rgba(150, 200, 255, 0.1)');
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fillStyle = dewGrad;
        ctx.fill();
        ctx.beginPath();
        ctx.arc(x - r * 0.25, y - r * 0.25, r * 0.3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.fill();
        ctx.restore();
      }

      // Falling petals from wither
      const fallingPetals = [];

      function spawnFallingPetal() {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.random() * 30 + 10;
        fallingPetals.push({
          x: cx + Math.cos(angle) * dist,
          y: cy + Math.sin(angle) * dist,
          vx: (Math.random() - 0.5) * 2.5,
          vy: Math.random() * 1.5 + 0.5,
          rot: Math.random() * Math.PI * 2,
          rotSpeed: (Math.random() - 0.5) * 0.1,
          size: Math.random() * 8 + 5,
          alpha: 1,
          color: ['#FF80AD','#FF4D88','#FF1F5F','#FFB3C6','#FF70A0'][Math.floor(Math.random()*5)]
        });
      }

      function drawFallingPetals() {
        for (let i = fallingPetals.length - 1; i >= 0; i--) {
          const p = fallingPetals[i];
          p.x += p.vx + Math.sin(Date.now() * 0.003 + i) * 0.3;
          p.y += p.vy;
          p.rot += p.rotSpeed;
          p.alpha -= 0.006;
          if (p.alpha <= 0 || p.y > H + 20) {
            fallingPetals.splice(i, 1);
            continue;
          }

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.globalAlpha = p.alpha;

          const s = p.size;
          ctx.beginPath();
          ctx.moveTo(0, -s);
          ctx.bezierCurveTo(s * 0.7, -s * 0.5, s * 0.5, s * 0.2, 0, s * 0.4);
          ctx.bezierCurveTo(-s * 0.5, s * 0.2, -s * 0.7, -s * 0.5, 0, -s);
          ctx.fillStyle = p.color;
          ctx.fill();

          ctx.globalAlpha = 1;
          ctx.restore();
        }
      }

      // Animation timing
      let lastFallingSpawn = 0;

      function animate() {
        ctx.clearRect(0, 0, W, H);

        const elapsed = (Date.now() - startTime) % CYCLE;
        const sec = elapsed / 1000; // 0 to 10

        // Phase calculations
        let bloomProgress = 0;   // 0-1 how much bloomed
        let witherFactor = 0;    // 0-1 how withered
        let scaleOverall = 1;
        let globalRotation = 0;

        if (sec < 3) {
          // Phase 1: Bloom (0s - 3s)
          const t = sec / 3;
          bloomProgress = easeOutCubic(t);
          globalRotation = t * 0.15;
        } else if (sec < 5) {
          // Phase 2: Full bloom (3s - 5s)
          bloomProgress = 1;
          globalRotation = 0.15;
        } else if (sec < 8) {
          // Phase 3: Wither (5s - 8s)
          const t = (sec - 5) / 3;
          bloomProgress = 1;
          witherFactor = easeInCubic(t);
          scaleOverall = 1 - 0.1 * witherFactor; // scale down to 0.9
          globalRotation = 0.15 - 0.05 * witherFactor;

          // Spawn falling petals
          const now = Date.now();
          const spawnRate = 60 + 120 * witherFactor; // more as wither progresses
          if (now - lastFallingSpawn > (200 - spawnRate)) {
            spawnFallingPetal();
            lastFallingSpawn = now;
          }
        } else {
          // Phase 4: Reset (8s - 10s)
          const t = (sec - 8) / 2;
          const eased = easeInOutCubic(t);
          bloomProgress = 1 - eased; // shrink back
          witherFactor = 1 - eased; // colors recover as it shrinks
          scaleOverall = 0.9 - 0.7 * eased; // scale down to ~0.2
          globalRotation = 0.1 * (1 - eased);
        }

        // Also spawn some petals in bloom phase (light)
        if (sec >= 1 && sec < 5) {
          const now = Date.now();
          if (now - lastFallingSpawn > 500) {
            if (Math.random() < 0.3) spawnFallingPetal();
            lastFallingSpawn = now;
          }
        }

        // Draw falling petals (behind rose)
        drawFallingPetals();

        // Draw the rose
        ctx.save();
        ctx.translate(cx, cy);
        ctx.scale(scaleOverall, scaleOverall);
        ctx.rotate(globalRotation);
        ctx.translate(-cx, -cy);

        const time = Date.now();

        // Droop angle for wither
        const droopBase = witherFactor * 0.15;

        // OUTER LAYER: 12 petals
        const outerProgress = Math.min(1, bloomProgress / 0.35);
        if (outerProgress > 0) {
          const pal = blendPalette(outerColors, witherOuter, witherFactor);
          for (let i = 0; i < 12; i++) {
            const angle = (i / 12) * Math.PI * 2 - Math.PI / 2;
            const sway = Math.sin(time * 0.001 + i * 0.7) * 0.03;
            const droop = droopBase * (0.5 + 0.5 * Math.sin(i * 1.3));
            // Slight wavy edge by varying radiusX
            const waveX = 52 + Math.sin(i * 1.1) * 4;
            drawPetal(cx, cy, angle + sway, waveX * outerProgress, 72 * outerProgress, pal.inner, pal.outer, 0.7 + outerProgress * 0.3, droop);
          }
        }

        // MIDDLE LAYER: 8 petals
        const midProgress = Math.min(1, Math.max(0, (bloomProgress - 0.2) / 0.35));
        if (midProgress > 0) {
          const pal = blendPalette(midColors, witherMid, witherFactor);
          for (let i = 0; i < 8; i++) {
            const angle = (i / 8) * Math.PI * 2 - Math.PI / 2 + 0.25;
            const sway = Math.sin(time * 0.0012 + i * 0.9) * 0.025;
            const droop = droopBase * 0.6 * (0.5 + 0.5 * Math.cos(i * 1.7));
            drawPetal(cx, cy, angle + sway, 40 * midProgress, 56 * midProgress, pal.inner, pal.outer, 0.75 + midProgress * 0.25, droop);
          }
        }

        // INNER LAYER: 5 petals
        const innerProgress = Math.min(1, Math.max(0, (bloomProgress - 0.45) / 0.35));
        if (innerProgress > 0) {
          const pal = blendPalette(innerColors, witherInner, witherFactor);
          for (let i = 0; i < 5; i++) {
            const angle = (i / 5) * Math.PI * 2 - Math.PI / 2 + 0.5;
            const sway = Math.sin(time * 0.0014 + i * 1.3) * 0.02;
            drawPetal(cx, cy, angle + sway, 28 * innerProgress, 40 * innerProgress, pal.inner, pal.outer, 0.8 + innerProgress * 0.2, 0);
          }
        }

        // CENTER
        const centerProgress = Math.min(1, Math.max(0, (bloomProgress - 0.6) / 0.3));
        if (centerProgress > 0) {
          drawRoseCenter(centerProgress, witherFactor);
        }

        // DEW DROPS (only during full bloom)
        if (sec >= 3 && sec < 6 && bloomProgress > 0.8) {
          const dewAlpha = sec < 5 ? 1 : Math.max(0, 1 - (sec - 5));
          ctx.globalAlpha = dewAlpha;
          drawDewDrop(cx + 22, cy - 28, 3);
          drawDewDrop(cx - 16, cy - 40, 2.5);
          drawDewDrop(cx + 8, cy + 8, 2);
          ctx.globalAlpha = 1;
        }

        // GLOW around rose
        if (bloomProgress > 0.5) {
          const glowAlpha = (bloomProgress - 0.5) * 0.15 * (1 - witherFactor * 0.7);
          const roseGlow = ctx.createRadialGradient(cx, cy, 20, cx, cy, 100);
          roseGlow.addColorStop(0, `rgba(255, 80, 120, ${glowAlpha})`);
          roseGlow.addColorStop(1, 'rgba(255, 80, 120, 0)');
          ctx.fillStyle = roseGlow;
          ctx.fillRect(0, 0, W, H);
        }

        ctx.restore();

        requestAnimationFrame(animate);
      }

      animate();
    })();


    // ============================================================
    //  3. GLOBAL FALLING PETALS CANVAS
    // ============================================================
    (function() {
      const canvas = document.getElementById('petalCanvas');
      const ctx = canvas.getContext('2d');
      let W, H;
      const petals = [];
      const hearts = [];
      const PETAL_COUNT = 30;

      function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resize);
      resize();

      for (let i = 0; i < PETAL_COUNT; i++) {
        petals.push(createPetal());
      }

      function createPetal() {
        return {
          x: Math.random() * (typeof W !== 'undefined' ? W : window.innerWidth),
          y: Math.random() * -(typeof H !== 'undefined' ? H : window.innerHeight),
          size: Math.random() * 10 + 5,
          speedY: Math.random() * 1 + 0.3,
          speedX: (Math.random() - 0.5) * 0.6,
          rotation: Math.random() * Math.PI * 2,
          rotSpeed: (Math.random() - 0.5) * 0.04,
          wobble: Math.random() * Math.PI * 2,
          wobbleSpeed: Math.random() * 0.03 + 0.01,
          opacity: Math.random() * 0.4 + 0.4,
          color: ['#ff6b8a','#ff8fa3','#ffb3c1','#ffc2d1','#ff4d6d','#ff758f','#FF80AD','#FF4D88'][Math.floor(Math.random()*8)]
        };
      }

      function darken(hex) {
        const r = Math.max(0, parseInt(hex.slice(1,3),16) - 40);
        const g = Math.max(0, parseInt(hex.slice(3,5),16) - 30);
        const b = Math.max(0, parseInt(hex.slice(5,7),16) - 20);
        return `rgb(${r},${g},${b})`;
      }

      function drawPetalShape(p) {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.globalAlpha = p.opacity;
        const s = p.size;
        ctx.beginPath();
        ctx.moveTo(0, -s);
        ctx.bezierCurveTo(s * 0.8, -s * 0.6, s * 0.6, s * 0.2, 0, s * 0.5);
        ctx.bezierCurveTo(-s * 0.6, s * 0.2, -s * 0.8, -s * 0.6, 0, -s);
        const grad = ctx.createRadialGradient(0, 0, 0, 0, 0, s);
        grad.addColorStop(0, p.color);
        grad.addColorStop(1, darken(p.color));
        ctx.fillStyle = grad;
        ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.1)';
        ctx.lineWidth = 0.3;
        ctx.stroke();
        ctx.globalAlpha = 1;
        ctx.restore();
      }

      function spawnHeart() {
        hearts.push({
          x: Math.random() * W,
          y: H + 20,
          size: Math.random() * 12 + 7,
          speedY: -(Math.random() * 1.2 + 0.4),
          speedX: (Math.random() - 0.5) * 0.4,
          opacity: Math.random() * 0.35 + 0.15,
          rotation: (Math.random() - 0.5) * 0.5,
          color: ['#ff4d6d','#ff6b8a','#ff8fa3','#FF1F5F'][Math.floor(Math.random()*4)]
        });
      }
      setInterval(spawnHeart, 1400);

      function drawHeart(h) {
        ctx.save();
        ctx.translate(h.x, h.y);
        ctx.rotate(h.rotation);
        ctx.globalAlpha = h.opacity;
        ctx.scale(h.size / 20, h.size / 20);
        ctx.beginPath();
        ctx.moveTo(0, -5);
        ctx.bezierCurveTo(-10, -15, -20, -5, -10, 5);
        ctx.lineTo(0, 15);
        ctx.lineTo(10, 5);
        ctx.bezierCurveTo(20, -5, 10, -15, 0, -5);
        ctx.fillStyle = h.color;
        ctx.fill();
        ctx.beginPath();
        ctx.arc(-5, -5, 3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.restore();
      }

      function animate() {
        ctx.clearRect(0, 0, W, H);

        for (const p of petals) {
          p.y += p.speedY;
          p.wobble += p.wobbleSpeed;
          p.x += p.speedX + Math.sin(p.wobble) * 0.4;
          p.rotation += p.rotSpeed;
          if (p.y > H + 20) {
            Object.assign(p, createPetal());
            p.y = -20;
          }
          drawPetalShape(p);
        }

        for (let i = hearts.length - 1; i >= 0; i--) {
          const h = hearts[i];
          h.y += h.speedY;
          h.x += h.speedX + Math.sin(Date.now() * 0.002 + i) * 0.3;
          h.opacity -= 0.001;
          if (h.y < -30 || h.opacity <= 0) {
            hearts.splice(i, 1);
            continue;
          }
          drawHeart(h);
        }

        requestAnimationFrame(animate);
      }
      animate();
    })();


    // ============================================================
    //  4. FIREFLIES
    // ============================================================
    (function() {
      const container = document.getElementById('fireflies');
      const FIREFLY_COUNT = 20;

      for (let i = 0; i < FIREFLY_COUNT; i++) {
        const el = document.createElement('div');
        el.classList.add('firefly');
        const size = Math.random() * 4 + 2;
        el.style.width = size + 'px';
        el.style.height = size + 'px';
        el.style.left = Math.random() * 100 + '%';
        el.style.top = (60 + Math.random() * 40) + '%';
        const duration = 8 + Math.random() * 12;
        const delay = Math.random() * duration;
        el.style.animationDuration = duration + 's, ' + (2 + Math.random() * 2) + 's';
        el.style.animationDelay = delay + 's, ' + (Math.random() * 2) + 's';
        const hue = Math.random() > 0.5 ? '50, 100%, 80%' : '340, 80%, 75%';
        el.style.background = `hsl(${hue})`;
        el.style.boxShadow = `0 0 ${size*2}px ${size}px hsla(${hue}, 0.6), 0 0 ${size*4}px ${size*2}px hsla(${hue}, 0.3)`;
        container.appendChild(el);
      }
    })();


    // ============================================================
    //  5. MOUSE SPARKLE TRAIL
    // ============================================================
    (function() {
      const sparkles = [];

      document.addEventListener('mousemove', function(e) {
        for (let i = 0; i < 2; i++) {
          sparkles.push({
            x: e.clientX + (Math.random() - 0.5) * 20,
            y: e.clientY + (Math.random() - 0.5) * 20,
            size: Math.random() * 4 + 1,
            life: 1,
            color: ['#ffd700','#ff6b8a','#ffb3c1','#ffffff'][Math.floor(Math.random()*4)]
          });
        }
      });

      const sparkleCanvas = document.createElement('canvas');
      sparkleCanvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none;';
      document.body.appendChild(sparkleCanvas);
      const sCtx = sparkleCanvas.getContext('2d');

      function resize() {
        sparkleCanvas.width = window.innerWidth;
        sparkleCanvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resize);
      resize();

      function animateSparkles() {
        sCtx.clearRect(0, 0, sparkleCanvas.width, sparkleCanvas.height);
        for (let i = sparkles.length - 1; i >= 0; i--) {
          const sp = sparkles[i];
          sp.life -= 0.025;
          sp.y -= 0.5;
          sp.size *= 0.98;
          if (sp.life <= 0) { sparkles.splice(i, 1); continue; }
          sCtx.save();
          sCtx.globalAlpha = sp.life;
          sCtx.translate(sp.x, sp.y);
          const s = sp.size;
          sCtx.beginPath();
          for (let j = 0; j < 4; j++) {
            const a = (j / 4) * Math.PI * 2 - Math.PI / 4;
            const outerX = Math.cos(a) * s;
            const outerY = Math.sin(a) * s;
            const innerA = a + Math.PI / 4;
            const innerX = Math.cos(innerA) * s * 0.3;
            const innerY = Math.sin(innerA) * s * 0.3;
            if (j === 0) sCtx.moveTo(outerX, outerY);
            else sCtx.lineTo(outerX, outerY);
            sCtx.lineTo(innerX, innerY);
          }
          sCtx.closePath();
          sCtx.fillStyle = sp.color;
          sCtx.shadowColor = sp.color;
          sCtx.shadowBlur = 6;
          sCtx.fill();
          sCtx.restore();
        }
        requestAnimationFrame(animateSparkles);
      }
      animateSparkles();
    })();

document.body.addEventListener('click', function() {
  window.location.href = 'public/love/index.html';
});
</script>
</body>
</html>
